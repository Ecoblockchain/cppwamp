<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.7"/>
<title>CppWAMP: Subscriptions</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
  $(window).load(resizeHeight);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">CppWAMP
   </div>
   <div id="projectbrief">C++11 client library for the WAMP protocol</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.7 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="examples.html"><span>Examples</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('_subscriptions.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(11)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">Subscriptions </div>  </div>
</div><!--header-->
<div class="contents">
<div class="toc"><h3>Table of Contents</h3>
<ul><li class="level1"><a href="#EventSlots">Event Slots</a></li>
<li class="level1"><a href="#BasicEventSlots">Basic Event Slots</a></li>
<li class="level1"><a href="#UnpackedEventSlots">Unpacked Event Slots</a></li>
<li class="level1"><a href="#ScopedSubscriptions">Scoped Subscriptions</a></li>
</ul>
</div>
<div class="textblock"><h1><a class="anchor" id="EventSlots"></a>
Event Slots</h1>
<p>A <em>slot</em> is a <em>callable target</em> that is called in response to a <em>signal</em> (the signal being the event topic in this case). The term <em>slot</em>, borrowed from <a href="http://doc.qt.io/qt-5/signalsandslots.html">Qt's signals and slots</a>, is used to distinguish an event handler from an asynchronous operation handler.</p>
<p>A <em>callable target</em> can be:</p><ul>
<li>a free function,</li>
<li>a bound member function (using <code>std::bind</code>),</li>
<li>a function object,</li>
<li>a lambda function, etc.</li>
</ul>
<p>An <em>event slot</em> represents an event handler that does not have any expectations on the event payload arguments. If necessary, the payload arguments must be checked during runtime, in the body of the event handler.</p>
<p><a class="el" href="classwamp_1_1_session.html#a93b8686842db786a7d065c601f75cb5a" title="Subscribes to WAMP pub/sub events having the given topic. ">wamp::Session::subscribe</a> expects an event slot with the following signature:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <span class="keyword">function</span>(<a class="code" href="classwamp_1_1_event.html">wamp::Event</a>)</div>
</div><!-- fragment --><p>where <a class="el" href="classwamp_1_1_event.html" title="Represents a published event. ">wamp::Event</a> is an object containing information and payload arguments related to the publication.</p>
<h1><a class="anchor" id="BasicEventSlots"></a>
Basic Event Slots</h1>
<p>An <em>basic event slot</em> represents an event handler that expects one or more payload arguments having specific, static types. The <a class="el" href="classwamp_1_1_basic_event_unpacker.html#ade5b8fba219aa39780f143feeb088114">wamp::basicEvent</a> function can be used when registering such event slots. It takes a basic event slot, and converts it into a regular event slot that can be passed to <a class="el" href="classwamp_1_1_session.html#a93b8686842db786a7d065c601f75cb5a" title="Subscribes to WAMP pub/sub events having the given topic. ">wamp::Session::subscribe</a>.</p>
<p><code>wamp::basicEvent</code> expects an event slot with the following signature:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <span class="keyword">function</span>(TArgs...)</div>
</div><!-- fragment --><p> where <code>TArgs...</code> matches the template parameter pack that was passed to <code>wamp::basicEvent</code>.</p>
<p>Examples of basic event slots are: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> onSensorSampled(<span class="keywordtype">float</span> value) { ... }</div>
<div class="line"><span class="comment">//                     ^</span></div>
<div class="line"><span class="comment">//                    TArgs</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> onPurchase(std::string item, <span class="keywordtype">int</span> cost, <span class="keywordtype">int</span> qty) { ... }</div>
<div class="line"><span class="comment">//                      ^          ^          ^</span></div>
<div class="line"><span class="comment">//                      \----------|----------/</span></div>
<div class="line"><span class="comment">//                               TArgs</span></div>
</div><!-- fragment --><p>The above slots can be registered as follows: </p><div class="fragment"><div class="line">session-&gt;subscribe(Topic(<span class="stringliteral">&quot;sensorSampled&quot;</span>),</div>
<div class="line">                   basicEvent&lt;float&gt;(&amp;onSensorSampled),</div>
<div class="line">                   handler);</div>
<div class="line"></div>
<div class="line">session-&gt;subscribe(Topic(<span class="stringliteral">&quot;itemPurchased&quot;</span>),</div>
<div class="line">                   basicEvent&lt;std::string, int, int&gt;(&amp;onPurchase),</div>
<div class="line">                   handler);</div>
</div><!-- fragment --><p>where <code>handler</code> is the asynchronous handler (or coroutine yield context) for the <b>subscribe operation itself</b>.</p>
<p>Whenever a <a class="el" href="classwamp_1_1_session.html" title="Asynchronous session API used by a client peer in WAMP applications. ">wamp::Session</a> dispatches an event to the above slots, it automatically unpacks the event payload positional arguments, and passes them to the slot's argument list. If <code>Session</code> cannot convert the event payload arguments to their target types, it issues a warning that can be captured via <a class="el" href="classwamp_1_1_session.html#a3af4c171dc1d0cb7b412adbd702528db" title="Sets the log handler for warnings. ">wamp::Session::setWarningHandler</a>.</p>
<h1><a class="anchor" id="UnpackedEventSlots"></a>
Unpacked Event Slots</h1>
<p>An <em>unpacked event slot</em> represents an event handler that expects one or more payload arguments having specific, static types. The <a class="el" href="classwamp_1_1_event_unpacker.html#acd803b2f9e7799a3c4279fe37c2ada5b">wamp::unpackedEvent</a> function can be used when registering such event slots. It takes an unpacked event slot, and converts it into a regular event slot that can be passed to <a class="el" href="classwamp_1_1_session.html#a93b8686842db786a7d065c601f75cb5a" title="Subscribes to WAMP pub/sub events having the given topic. ">wamp::Session::subscribe</a>.</p>
<p><code>wamp::unpackedEvent</code> expects an event slot with the following signature:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> <span class="keyword">function</span>(<a class="code" href="classwamp_1_1_event.html">wamp::Event</a>, TArgs...)</div>
</div><!-- fragment --><p> where</p><ul>
<li><a class="el" href="classwamp_1_1_event.html" title="Represents a published event. ">wamp::Event</a> is an object containing information and payload arguments related to the publication, and,</li>
<li><code>TArgs...</code> matches the template parameter pack that was passed to <code>wamp::unpackedEvent</code>.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Unpacked event slots differ from basic event slots in the following way: Unpacked event slots are passed a <a class="el" href="classwamp_1_1_event.html" title="Represents a published event. ">wamp::Event</a> object, which contains metadata on the event itself.</dd></dl>
<p>Examples of unpacked event slots are: </p><div class="fragment"><div class="line"><span class="keywordtype">void</span> onSensorSampled(Event event, <span class="keywordtype">float</span> value) { ... }</div>
<div class="line"><span class="comment">//                                  ^</span></div>
<div class="line"><span class="comment">//                                TArgs</span></div>
<div class="line"></div>
<div class="line"><span class="keywordtype">void</span> onPurchase(Event event, std::string item, <span class="keywordtype">int</span> cost, <span class="keywordtype">int</span> qty) { ... }</div>
<div class="line"><span class="comment">//                                  ^          ^          ^</span></div>
<div class="line"><span class="comment">//                                  \----------|----------/</span></div>
<div class="line"><span class="comment">//                                           TArgs</span></div>
</div><!-- fragment --><p>The above slots can be registered as follows: </p><div class="fragment"><div class="line">session-&gt;subscribe(Topic(<span class="stringliteral">&quot;sensorSampled&quot;</span>),</div>
<div class="line">                   unpackedEvent&lt;float&gt;(&amp;onSensorSampled),</div>
<div class="line">                   handler);</div>
<div class="line"></div>
<div class="line">session-&gt;subscribe(Topic(<span class="stringliteral">&quot;itemPurchased&quot;</span>),</div>
<div class="line">                   unpackedEvent&lt;std::string, int, int&gt;(&amp;onPurchase),</div>
<div class="line">                   handler);</div>
</div><!-- fragment --><p>where <code>handler</code> is the asynchronous handler (or coroutine yield context) for the <b>subscribe operation itself</b>.</p>
<p>Whenever a <a class="el" href="classwamp_1_1_session.html" title="Asynchronous session API used by a client peer in WAMP applications. ">wamp::Session</a> dispatches an event to the above slots, it automatically unpacks the event payload positional arguments, and passes them to the slot's argument list. If <code>Session</code> cannot convert the event payload arguments to their target types, it issues a warning that can be captured via <a class="el" href="classwamp_1_1_session.html#a3af4c171dc1d0cb7b412adbd702528db" title="Sets the log handler for warnings. ">wamp::Session::setWarningHandler</a>.</p>
<h1><a class="anchor" id="ScopedSubscriptions"></a>
Scoped Subscriptions</h1>
<p>A <a class="el" href="classwamp_1_1_scoped_subscription.html" title="Limits a Subscription&#39;s lifetime to a particular scope. ">wamp::ScopedSubscription</a> object can be used to limit a subscription's lifetime to a particular scope. When a <code>ScopedSubscription</code> object is destroyed, it automatically unsubscribes the subscription. This helps in automating the lifetime management of topic subscriptions using RAII techniques.</p>
<p>Here's an example illustrating how <code>ScopedSubscription</code> can be used to manage the lifetime of a subscription:</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>Observer</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">void</span> onEvent(Event event);</div>
<div class="line"></div>
<div class="line">    ScopedSubscription sub;</div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><span class="keywordtype">int</span> main()</div>
<div class="line">{</div>
<div class="line">    boost::asio::io_service iosvc;</div>
<div class="line">    boost::asio::spawn(iosvc, [&amp;](boost::asio::yield_context yield)</div>
<div class="line">    {</div>
<div class="line">        <span class="keyword">auto</span> session = CoroSession&lt;&gt;::create(connectorList);</div>
<div class="line">        session-&gt;connect(yield);</div>
<div class="line">        session-&gt;join(<span class="stringliteral">&quot;somerealm&quot;</span>, yield);</div>
<div class="line"></div>
<div class="line">        {</div>
<div class="line">            <span class="keyword">using</span> std::placeholders;</div>
<div class="line">            Observer observer;</div>
<div class="line">            observer.sub = session-&gt;subscribe(</div>
<div class="line">                            Topic(<span class="stringliteral">&quot;sometopic&quot;</span>),</div>
<div class="line">                            std::bind(&amp;Observer::onEvent, observer, _1),</div>
<div class="line">                            yield);</div>
<div class="line"></div>
<div class="line">        }  <span class="comment">// When the &#39;observer&#39; object leaves this scope, its</span></div>
<div class="line">           <span class="comment">// ScopedSubscription member gets destroyed. This will</span></div>
<div class="line">           <span class="comment">// automatically unsubscribe the subscription, thereby avoiding</span></div>
<div class="line">           <span class="comment">// further member function calls on the deleted &#39;observer&#39; object.</span></div>
<div class="line">    });</div>
<div class="line">    iosvc.run();</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Tue Oct 27 2015 13:33:26 for CppWAMP by
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="doxygen.png" alt="doxygen"/></a> 1.8.7 </li>
  </ul>
</div>
</body>
</html>
